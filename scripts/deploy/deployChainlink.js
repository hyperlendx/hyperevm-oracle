const hre = require("hardhat");

const { verify } = require("../utils/verify")

main()

async function main(description, asset, priceFeedId) {
    const verifier = '0x60fAa7faC949aF392DFc858F5d97E3EEfa07E9EB';

    const sourceConsumer = await hre.ethers.deployContract("ChainlinkConsumer", [
        verifier
    ], {gasPrice: 5000000000, gasLimit: 2000000});
    await sourceConsumer.waitForDeployment();
    // await verify(proxy.target, [
    //     pythContract, description, asset, priceFeedId
    // ])

    // console.log(sourceConsumer.target)
    // console.log(await proxy.latestRoundData())

    // const sourceConsumer = await hre.ethers.getContractAt("ChainlinkConsumer", "0x1D28C47C4184Cd4cBb088b453954fD3F9dEE826c");

    await sourceConsumer.verifyReport(
        '0x00090d9e8d96765a0c49e03a6ae05c82e8f8de70cf179baa632f18313e54bd69000000000000000000000000000000000000000000000000000000000014ea8e000000000000000000000000000000000000000000000000000000030000000100000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000280010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001200003cbac760d50c462267f3127374f5fa039eb971dd4a58a2b4f2b664769f8ea00000000000000000000000000000000000000000000000000000000682b64f400000000000000000000000000000000000000000000000000000000682b64f40000000000000000000000000000000000000000000000000000734422dab360000000000000000000000000000000000000000000000000004854d9a0b3f81c000000000000000000000000000000000000000000000000000000006852f1f40000000000000000000000000000000000000000000000016c2fb7bc9654bd000000000000000000000000000000000000000000000000016c2d8f5dfb6ce7280000000000000000000000000000000000000000000000016c31e01b313c94cc0000000000000000000000000000000000000000000000000000000000000002f6742656ec1f3c087c6348183834f684f84168a8581d6d1e1cfacf5e12617dd11d3402c2cef1b1bceefc62472e0505b656ad2730597a54d07647bfde0c7c43a60000000000000000000000000000000000000000000000000000000000000002074a8c50da27a989f7ccb6f3cf43ed9261b5a94e8457f90737dec8cc256e3df6422839949841ca1827c4f9d48dea9cb8a27e3dba7aa3dc79374959e8c134f913'
    , {gasLimit: 2000000})

    console.log(await sourceConsumer.lastDecodedPrice())

    const feedId = '0x0003cbac760d50c462267f3127374f5fa039eb971dd4a58a2b4f2b664769f8ea'
    const singleFeed = await hre.ethers.deployContract("SingleFeedProvider", [
        sourceConsumer.target, feedId
    ], {gasPrice: 5000000000, gasLimit: 2000000});
    await singleFeed.waitForDeployment();
    console.log(singleFeed.target)

    console.log(await singleFeed.latestAnswer())
    console.log(await singleFeed.latestRoundData())

    return null
}

module.exports.main = main
